function initializeCRUDForm(){initializeValidationCRUDForm();updateProperties();initializePropertyFieldset();$(".crud-form .add.button").each(function(){var n=$(this);n.click(function(){onClickActionButton(this,function(t){var i=n.siblings(".ui.search.selection.dropdown"),u=i.find(".menu"),r=t.results.Current;i!==undefined&&r!==undefined&&(u.append('<div class="item" data-value="'+r.value+'">'+r.text+"<\/div>"),i.dropdown("refresh"),i.dropdown("set selected",r.value))})})});$(".crud-form .add-property.button").click(function(){addPropertyForm($(".crud-form .properties"));updateProperties();initializeValidationCRUDForm()});$(".crud-form .ui.dropdown").dropdown({onChange:function(){updateProperties()}})}function crudFormSubmit(n,t){n=$(n);var r=n.closest("form").attr("action"),u=n.closest("form").serialize(),i=1e3;activeMessageLoader();$.ajax({url:r,type:"post",data:u,success:function(n){if(n!==undefined){if(inactiveMessageLoader(),showMessage(n),n.type!=="error"){if(activeMessageProgress(),n.results.Reload!==undefined&&n.results.Reload===!0)setTimeout(function(){location.reload();message.modal("hide")},i);else{var r=n.results.RedirectUrl;r!==undefined&&setTimeout(function(){location=r;message.modal("hide")},i)}t!==undefined&&t(n)}}else inactiveMessageLoader(),showDefaultErrorMessage()},error:function(){inactiveMessageLoader();showDefaultErrorMessage()}})}function initializeFormModal(n){var t=$("#form-modal > .crud-form"),i=createFieldsRules(t);t.form({fields:i,inline:!0,on:"blur"});t.submit(function(t){t.preventDefault();crudFormSubmit(this,n)});updateProperties();initializePropertyFieldset();t.find(".cancel.button").click(function(){hideFormModal()});$("#form-modal > .crud-form .add-property.button").click(function(){addPropertyForm($("#form-modal > .crud-form .properties"));var n=createFieldsRules(t);t.form({fields:n,inline:!0,on:"blur"})});$("#form-modal > .crud-form .ui.dropdown").dropdown({onChange:function(){updateProperties()}})}function initializePropertyFieldset(){$(".property .remove.button").click(function(){var n=$(this).closest(".property");n.transition({animation:"scale",onComplete:function(){$(this).closest(".property").remove();updateProperties();initializeValidationCRUDForm()}})})}function addPropertyForm(n){n=$(n);var t=$("#properties");n.append(t.html());t=n.children(".fields:last-child");initializePropertyFieldset()}function updateProperties(){var n=$(".crud-form .properties .fields");n.each(function(n){$(this).find("input").each(function(){var i=$(this).attr("default-name"),t;i!==undefined&&(t="properties["+n+"]."+i,$(this).attr("id",t),$(this).attr("name",t))});$(this).find(".ui.search").each(function(){$(this).search({minCharacters:0,apiSettings:{url:$(this).attr("href")+"?"+$(this).attr("for-id")+"="+$("#"+$(this).attr("for-id")).val()},fields:{results:"results",title:"title"},error:!1});$(this).search("clear cache")})})}function initializeDataTable(){var n=$(".data-table");$(".data-table .action-buttons .item").click(function(n){n.preventDefault();onClickActionButton(this)})}function initializeIndexPagination(){var n=$("#index-pagination > .ui.dropdown");n.dropdown("set selected",$("#page-index").val());n.dropdown({onChange:function(n){location.search({page:n})}})}function onClickActionButton(n,t){n=$(n);var r=n.attr("href"),i=$("#form-modal");activeMessageLoader();$.ajax({url:r,type:"post",success:function(n){typeof n=="string"?(i.html(n),initializeFormModal(t),inactiveMessageLoader(),i.modal("show")):(inactiveMessageLoader(),showMessage(n))},error:function(){return inactiveMessageLoader(),showDefaultErrorMessage(),null}})}function showDefaultErrorMessage(){var n=$("#message"),t=$("#message>.header>.title"),i=$("#message>.content");n.attr("type","error");t.text(t.attr("data-default-value"));i.text(i.attr("data-default-value"));n.children(".header").find(">.icon").addClass("hidden");n.children(".actions").find(">.button").addClass("hidden");n.children(".header").find(">.error").removeClass("hidden");n.children(".actions").find(">.error").removeClass("hidden");n.modal("show")}function showMessage(n){if(n!==undefined){var t=$("#message"),i=$("#message>.header>.title"),r=$("#message>.content");t.attr("type",n.type);i.text(n.header);r.text(n.content);t.children(".header").find(">.icon").addClass("hidden");t.children(".actions").find(">.button").addClass("hidden");t.children(".header").find(">."+n.type).removeClass("hidden");t.children(".actions").find(">."+n.type).removeClass("hidden");t.modal("show")}}function hideMessage(){$("#message").modal("hide")}function activeMessageLoader(){$("#message-loader").addClass("active")}function inactiveMessageLoader(){$("#message-loader").removeClass("active")}function initializeMessageProgress(n,t){$("#message-progress").progress({duration:n,total:t,onSuccess:function(){inactiveMessageProgress()}})}function activeMessageProgress(n){var t=$("#message-progress"),i=t.progress("get total"),r=n/i;t.progress("reset");t.removeClass("hidden");setInterval(function(){t.progress("increment")},r)}function inactiveMessageProgress(){var n=$("#message-progress");n.progress("reset");n.addClass("hidden")}function showFormModal(){$("#form-modal").modal("show")}function hideFormModal(){$("#form-modal").modal("hide")}$(document).ready(function(){initializeCRUDForm();$("#form-modal").modal({autofocus:!1});initializeDataTable();initializeIndexPagination();initializeMessageProgress(0,100);$(".ui.search").each(function(){$(this).search({apiSettings:{url:$(this).attr("href")+"?search={query}"},cache:!1,fields:{results:"results",title:"title",description:"description"},minCharacters:0,error:!1})})});